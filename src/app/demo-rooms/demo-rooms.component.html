<section class="demo-rooms-section">
    <div class="container">
        <h2 class="section-title">Recommended for You</h2>

        <div *ngIf="isLoading" class="loading-state">
            <div class="spinner"></div>
            <p>Loading best rooms for you...</p>
        </div>

        <div *ngIf="error" class="error-state">
            <p>{{ error }}</p>
            <button (click)="fetchRooms()" class="retry-btn">Retry</button>
        </div>

        <div class="controls-bar" *ngIf="!isLoading && !error">
            <div class="sort-container">
                <label for="sort-select">Sort By:</label>
                <div class="select-wrapper">
                    <select id="sort-select" [ngModel]="sortOption" (ngModelChange)="onSortChange($event)">
                        <option value="default">Default</option>
                        <option value="rent-low-high">Rent: Low to High</option>
                        <option value="rent-high-low">Rent: High to Low</option>
                        <option value="room-type">Room Type</option>
                        <option value="recent">Recently Added</option>
                    </select>
                </div>
            </div>
            <span class="result-count">{{ demoRooms.length }} places found</span>
        </div>

        <div class="product-grid" *ngIf="!isLoading && !error">
            <div *ngFor="let room of demoRooms" class="product-card" (click)="openDetails(room)">
                <div class="image-container">
                    <img [src]="getMainImage(room)" [alt]="room.houseAddress" class="product-image"
                        onerror="this.src='https://placehold.co/600x400?text=No+Image'">
                    <span *ngIf="room.houseProofVerified" class="badge-verified">Verified</span>
                </div>
                <div class="product-details">
                    <h3 class="product-title">{{ room.houseType }} ({{ room.roomSharingType }})</h3>
                    <div class="product-rating">
                        <span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span>
                        <span class="rating-count">({{ room.reviews || 12 }} reviews)</span>
                    </div>
                    <div class="product-price">
                        <span class="currency">‚Çπ</span>
                        <span class="amount">{{ room.price | number }}</span>
                        <span class="period">/mo</span>
                    </div>
                    <div class="product-meta">
                        <span class="meta-item">{{ room.roomType }}</span> ‚Ä¢
                        <span class="meta-item">{{ room.furnishingType }}</span>
                    </div>
                    <p class="product-location">üìç {{ room.houseAddress | titlecase }}</p>
                    <p class="delivery-info">Available immediately</p>
                    <button class="btn-view-details">See Details</button>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Details Modal -->
<div class="modal-overlay" *ngIf="selectedRoom" (click)="closeDetails()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <button class="close-btn" (click)="closeDetails()">&times;</button>
        <div class="modal-body">
            <div class="modal-image-col">
                <img [src]="currentMainImage" [alt]="selectedRoom.houseType" class="modal-main-image"
                    onerror="this.src='https://placehold.co/600x400?text=No+Image'">

                <!-- Image Gallery Thumbs -->
                <div class="image-gallery" *ngIf="selectedRoom.imageUrls && selectedRoom.imageUrls.length > 1">
                    <div *ngFor="let img of selectedRoom.imageUrls" class="thumb"
                        [class.active]="currentMainImage === img" (click)="setMainModalImage(img)">
                        <img [src]="img" alt="Room view" onerror="this.src='https://placehold.co/100x100?text=No+Img'">
                    </div>
                </div>
            </div>

            <div class="modal-info-col">
                <h2 class="modal-title">{{ selectedRoom.houseType }} ({{ selectedRoom.roomSharingType }})</h2>
                <p class="modal-location">üìç {{ selectedRoom.houseAddress }} - {{ selectedRoom.pinCode }}</p>

                <div class="modal-rating">
                    <span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span>
                    <span>{{ selectedRoom.rating || 4.5 }} out of 5</span>
                </div>

                <div class="modal-price-box">
                    <span class="modal-price">‚Çπ{{ selectedRoom.price | number }}</span>
                    <span class="modal-period">per month</span>
                </div>

                <div class="detail-badges">
                    <span class="badge">{{ selectedRoom.roomType }}</span>
                    <span class="badge">{{ selectedRoom.furnishingType }}</span>
                    <span class="badge" *ngIf="selectedRoom.houseProofVerified">Verified Owner</span>
                </div>

                <hr class="divider">

                <div class="modal-description">
                    <h3>About this place</h3>
                    <p>{{ selectedRoom.description }}</p>

                    <h3 *ngIf="selectedRoom.nearbyPlaces" class="mt-4">Nearby Places</h3>
                    <p *ngIf="selectedRoom.nearbyPlaces">{{ selectedRoom.nearbyPlaces }}</p>

                    <h3 *ngIf="selectedRoom.rulesAndBenefits" class="mt-4">Rules & Benefits</h3>
                    <p *ngIf="selectedRoom.rulesAndBenefits">{{ selectedRoom.rulesAndBenefits }}</p>
                </div>

                <div class="modal-actions">
                    <button class="btn-contact">Contact Owner</button>
                    <button class="btn-wishlist">Add to Wishlist</button>
                </div>
            </div>
        </div>
    </div>
</div>

<app-top-five-modal [rooms]="topFiveRooms" [title]="modalTitle" [isVisible]="isModalVisible" (closeEvent)="closeModal()"
    (viewAllEvent)="handleViewAll()" (viewRoomEvent)="handleViewRoom($event)">
</app-top-five-modal>